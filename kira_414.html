<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>🎮 متجر كيرا</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg1: #061026;
      --bg2: #022544;
      --card: rgba(10,16,30,0.95);
      --accent: #67b7ff;
      --muted: #b6d9ff;
      --glass: rgba(255,255,255,0.03);
    }

    *{box-sizing: border-box}
    body{
      margin:0;
      font-family:'Cairo', Arial, sans-serif;
      background: linear-gradient(180deg, var(--bg1), var(--bg2));
      color: #eaf6ff;
      padding-bottom:60px;
    }

    header{
      padding:24px 16px;
      text-align:center;
      position:sticky;
      top:0;
      z-index:50;
      background: linear-gradient(180deg, rgba(2,37,68,0.12), rgba(2,37,68,0.05));
      backdrop-filter: blur(6px);
      box-shadow: 0 4px 18px rgba(0,0,0,0.4);
    }
    .title{
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:center;
      flex-wrap:wrap;
    }
    .logo{
      background: linear-gradient(135deg,#0099ff,#003b8e);
      color:white;
      font-weight:800;
      padding:8px 12px;
      border-radius:10px;
      font-size:18px;
      box-shadow: 0 6px 18px rgba(0,120,255,0.18);
    }
    h1{ margin:0; font-size:1.55rem; letter-spacing:1px; }

    .controls{ margin-top:12px; display:flex;gap:12px; justify-content:center; flex-wrap:wrap; }

    .search {
      display:flex;align-items:center;gap:8px;
      background:var(--glass); padding:8px;border-radius:12px;
      width:min(760px,92%); box-shadow: inset 0 0 0 1px rgba(255,255,255,0.02);
    }
    .search input{ background:transparent;border:0;outline:0;color:var(--muted);font-size:16px;padding:8px 6px;width:100%; }
    .search .icon{font-size:20px;color:var(--accent);padding:2px 6px}

    .filters{ display:flex; gap:8px; flex-wrap:wrap; justify-content:center; margin-top:10px; }
    .filter-btn{
      background:transparent;border:1px solid rgba(255,255,255,0.06);
      color:var(--muted); padding:8px 12px;border-radius:999px; cursor:pointer; font-weight:600;
      transition: all .18s ease;
    }
    .filter-btn.active{
      background: linear-gradient(90deg,#0059d6,#003a8e); color:white;
      box-shadow: 0 6px 20px rgba(0,120,255,0.18); transform:translateY(-2px);
    }

    main{ padding:18px; max-width:1200px; margin: 10px auto 60px; }

    .grid{ display:grid; grid-template-columns: repeat(3, 1fr); gap:18px; margin-top:18px; }
    @media (max-width:1000px){ .grid{grid-template-columns: repeat(2,1fr)} }
    @media (max-width:640px){ .grid{grid-template-columns: repeat(1,1fr)} }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:14px; overflow:hidden; box-shadow: 0 8px 30px rgba(0,40,100,0.25);
      transition: transform .25s ease, box-shadow .25s ease; border: 1px solid rgba(255,255,255,0.03);
      display:flex; flex-direction:column; min-height:340px;
    }
    .card:hover{ transform:translateY(-8px); box-shadow: 0 18px 50px rgba(0,70,200,0.22); }

    .thumb{ width:100%; height:190px; object-fit:cover; display:block; background:linear-gradient(90deg,#022544,#00121f); }
    .card-body{ padding:12px 14px 16px; text-align:right; flex:1; display:flex; flex-direction:column; gap:10px; }

    .game-title{ display:flex; justify-content:space-between; gap:8px; align-items:center; }
    .game-title h3{ margin:0; font-size:1.05rem; color:#e6f7ff; }
    .meta{ color:var(--muted); font-size:0.95rem; margin:0; }

    .tags{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
    .tag{ font-size:12px; background:rgba(0,120,255,0.08); color:var(--accent); padding:4px 8px; border-radius:999px; border:1px solid rgba(0,120,255,0.06); }

    .actions{ display:flex; justify-content:space-between; align-items:center; gap:8px; margin-top:auto; }
    .left-actions{ display:flex; gap:8px; align-items:center; }
    .btn{ padding:8px 12px; border-radius:10px; border:0; cursor:pointer; font-weight:700; font-size:14px; background:linear-gradient(90deg,#007bff,#0047ab); color:white; box-shadow: 0 6px 18px rgba(0,70,200,0.18); transition:transform .14s ease; }
    .btn:active{ transform:translateY(1px); }
    .outline{ background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--muted); box-shadow:none; }

    .fav{ background:transparent; border:0; font-size:22px; cursor:pointer; color:rgba(255,255,255,0.65); transition: transform .12s ease; }
    .fav.active{ color:#ff6b9a; transform:scale(1.07); }

    .stars{ display:inline-flex; gap:4px; align-items:center; }
    .star{ font-size:18px; color:rgba(255,255,255,0.18); cursor:pointer; transition:color .12s; }
    .star.on{ color: #ffd166; }

    footer{ margin-top:30px; text-align:center; color:rgba(255,255,255,0.55); font-size:14px; }
    .badge{ background: linear-gradient(90deg,#00d4ff, #0066ff); padding:6px 10px; border-radius:999px; font-weight:700; color:white; box-shadow: 0 8px 20px rgba(0,100,255,0.12); }
    .empty{ text-align:center; padding:40px 10px; color:rgba(255,255,255,0.6); font-size:18px; }

  </style>
</head>
<body>

  <header>
    <div class="title">
      <div class="logo">متجر كيرا</div>
      <h1>🎮 متجر كيرا — متجر الألعاب المتكامل</h1>
    </div>

    <div class="controls">
      <div class="search" role="search" aria-label="بحث">
        <span class="icon">🔎</span>
        <input id="searchInput" type="search" placeholder="ابحث عن لعبة... (مثال: سباق، ذكاء، Flappy)"/>
        <button id="clearBtn" title="مسح" style="background:transparent;border:0;color:var(--muted);cursor:pointer;padding:6px">✖</button>
      </div>
    </div>

    <div class="filters" id="filters"></div>
  </header>

  <main>
    <div style="display:flex;justify-content:space-between;gap:12px;align-items:center;flex-wrap:wrap">
      <div style="display:flex;gap:8px;align-items:center">
        <span class="badge">70 ألعاب</span>
        <div style="color:var(--muted);margin-right:10px;font-weight:600">التصنيف: <span id="activeCat">الكل</span></div>
      </div>

      <div style="display:flex;gap:8px;align-items:center">
        <label style="color:var(--muted);font-weight:600">بحث سريع:</label>
        <select id="sortSelect" style="padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--muted)">
          <option value="relevance">الأكثر صلة</option>
          <option value="popular">الأكثر تقييماً</option>
          <option value="alpha">ترتيب أبجدي</option>
        </select>
      </div>
    </div>

    <div id="grid" class="grid" aria-live="polite"></div>
    <div id="empty" class="empty" style="display:none">لم نَجِد نتائج مطابقة. جرّب كلمة بحث أخرى.</div>

    <footer>
      تم تطوير الواجهة خصيصًا لمتجر كيرا — البحث، التصنيف، والمفضلات محفوظة محليًا.
    </footer>
  </main>

  <script>
    const games = [
      {id:1, name:"لعبة الحنش (Snake)", desc:"تحكم بالحنش وأكل التفاح بدون أن تصطدم", category:"أركيد", image:"https://source.unsplash.com/800x420/?snake,video-game"},
      {id:2, name:"كرة السلة", desc:"اضغط واسحب لرمي الكرة نحو السلة", category:"رياضة", image:"https://source.unsplash.com/800x420/?basketball,ball,stadium"},
      {id:3, name:"تفادي الصواريخ", desc:"تجنّب الصواريخ وحقق أعلى نقاط", category:"أكشن", image:"https://source.unsplash.com/800x420/?space,shooter,game"},
      {id:4, name:"تكسير الطوب", desc:"اكسر جميع الطوب بالكرة", category:"أركيد", image:"https://source.unsplash.com/800x420/?brick,block,game"},
      {id:5, name:"Flappy الطائر", desc:"اضغط لتخطي الأنابيب", category:"أركيد", image:"https://source.unsplash.com/800x420/?bird,flappy,game"},
      {id:6, name:"سباق السيارات", desc:"نافس لتصل أولاً لخط النهاية", category:"سباق", image:"https://source.unsplash.com/800x420/?race,car,racing"},
      {id:7, name:"قناص الدقة", desc:"صوّب بدقة على الأهداف المتحركة", category:"أكشن", image:"https://source.unsplash.com/800x420/?sniper,shooter,aim"},
      {id:8, name:"قنابل الوقت", desc:"فكّ الشفرة قبل انفجار القنابل", category:"ألغاز", image:"https://source.unsplash.com/800x420/?bomb,puzzle,clock"},
      {id:9, name:"ألغاز المنطق", desc:"حل ألغاز ذهنية ممتعة", category:"ألغاز", image:"https://source.unsplash.com/800x420/?puzzle,brain,logic"},
      {id:10, name:"هروب الأشباح", desc:"اجمع النجوم وتجنّب الأشباح", category:"مغامرة", image:"https://source.unsplash.com/800x420/?ghost,spooky,game"},
      {id:11, name:"صيد الطيور", desc:"أطلق سهامك لصيد الطيور", category:"رياضة", image:"https://source.unsplash.com/800x420/?archery,bow,arrow"},
      {id:12, name:"سباق الدراجات", desc:"قد دراجتك عبر مسارات وعرة", category:"سباق", image:"https://source.unsplash.com/800x420/?bike,racing,mountain"},
      {id:13, name:"دفاع القلعة", desc:"ابن دفاعاتك ودافع عن القلعة", category:"استراتيجية", image:"https://source.unsplash.com/800x420/?castle,defense,tower"},
      {id:14, name:"اختبار الذاكرة", desc:"اختبر ذاكرتك مع مراحل سريعة", category:"تعليمي", image:"https://source.unsplash.com/800x420/?memory,brain,game"},
      {id:15, name:"كرة القدم", desc:"سدد الركلات وحقق الفوز", category:"رياضة", image:"https://source.unsplash.com/800x420/?football,stadium,soccer"},
      {id:16, name:"لعبة الإيقاع", desc:"انقر مع الإيقاع لتحصل على نقاط", category:"موسيقى", image:"https://source.unsplash.com/800x420/?music,rhythm,game"},
      {id:17, name:"القفز المظلي", desc:"اهبط بأمان وتجنّب العقبات", category:"مغامرة", image:"https://source.unsplash.com/800x420/?skydiving,parachute,adventure"},
      {id:18, name:"طائرة الإنقاذ", desc:"أنقذ المدنيين باستخدام الطائرة", category:"مغامرة", image:"https://source.unsplash.com/800x420/?helicopter,rescue,mission"},
      {id:19, name:"مغامرات البطل", desc:"تجاوز المراحل واحصل على الكنوز", category:"مغامرة", image:"https://source.unsplash.com/800x420/?hero,platformer,game"},
      {id:20, name:"غزو الفضاء", desc:"دافع عن المجرة ضد الغزاة", category:"أكشن", image:"https://source.unsplash.com/800x420/?space,invaders,game"},
      {id:21, name:"معركة السحر", desc:"استخدم تعويذات لهزيمة الأعداء", category:"مغامرة", image:"https://source.unsplash.com/800x420/?magic,battle,spell"},
      {id:22, name:"صيد الأسماك", desc:"اصطد أسماك نادرة واحصل على نقاط", category:"محاكاة", image:"https://source.unsplash.com/800x420/?fishing,fish,boat"},
      {id:23, name:"متاهة الهروب", desc:"اخرج من المتاهة قبل نفاد الوقت", category:"ألغاز", image:"https://source.unsplash.com/800x420/?maze,labyrinth,escape"},
      {id:24, name:"البقاء على قيد الحياة", desc:"اجمع الموارد وابقَ حيًا", category:"استراتيجية", image:"https://source.unsplash.com/800x420/?survival,island,camp"},
      {id:25, name:"سباق الصحراء", desc:"قد عبر الرمال وتفادى العقبات", category:"سباق", image:"https://source.unsplash.com/800x420/?desert,rally,car"},
      {id:26, name:"مغامرة البركان", desc:"اهرب من البركان المتفجر", category:"مغامرة", image:"https://source.unsplash.com/800x420/?volcano,escape,adventure"},
      {id:27, name:"متسلق الجبال", desc:"تسلق القمم ولا تسقط", category:"رياضة", image:"https://source.unsplash.com/800x420/?mountain,climbing,peak"},
      {id:28, name:"سباق الشوارع", desc:"تحدَّ السائقين في شوارع المدينة", category:"سباق", image:"https://source.unsplash.com/800x420/?street,racing,car"},
      {id:29, name:"جمع الجواهر", desc:"اجمع الجواهر وتجنّب الفخاخ", category:"أركيد", image:"https://source.unsplash.com/800x420/?gems,jewels,treasure"},
      {id:30, name:"المحقق الذكي", desc:"حل القضايا واعثر على الأدلة", category:"ألغاز", image:"https://source.unsplash.com/800x420/?detective,mystery,clues"},
      {id:31, name:"مغامرات البحر", desc:"استكشف أعماق البحر وغالب الأخطار", category:"مغامرة", image:"https://source.unsplash.com/800x420/?underwater,diver,sea"},
      {id:32, name:"البطل الخارق", desc:"استعمل قواك لإنقاذ المدينة", category:"أكشن", image:"https://source.unsplash.com/800x420/?superhero,city,action"},
      {id:33, name:"تصويب الأهداف", desc:"أضرب الأهداف للحصول على مكافآت", category:"أركيد", image:"https://source.unsplash.com/800x420/?target,shooting,aim"},
      {id:34, name:"تركيب الصور", desc:"أعد تركيب الصورة من القطع", category:"ألغاز", image:"https://source.unsplash.com/800x420/?jigsaw,puzzle,pieces"},
      {id:35, name:"مغامرات الكلب", desc:"ساعد الكلب بجمع العظام", category:"مغامرة", image:"https://source.unsplash.com/800x420/?dog,puppy,adventure"},
      {id:36, name:"بناء المدينة", desc:"ابنِ مدينتك وطورها خطوة بخطوة", category:"محاكاة", image:"https://source.unsplash.com/800x420/?city,building,simulation"},
      {id:37, name:"تحدي الذكاء السريع", desc:"أجب بسرعة لتقييم مهاراتك", category:"تعليمي", image:"https://source.unsplash.com/800x420/?quiz,brain,challenge"},
      {id:38, name:"حرب الطائرات", desc:"قُد طائراتك وحارب أعداء السماء", category:"أكشن", image:"https://source.unsplash.com/800x420/?fighter,plane,combat"},
      {id:39, name:"الهروب من الديناصور", desc:"اركض واهرب من الديناصورات", category:"أركيد", image:"https://source.unsplash.com/800x420/?dinosaur,t-rex,chase"},
      {id:40, name:"سباق الرالي", desc:"تنافس في رالي عبر تضاريس متنوعة", category:"سباق", image:"https://source.unsplash.com/800x420/?rally,offroad,car"},
      {id:41, name:"مطابقة الثلاثة", desc:"ادمج القطع المتشابهة لإزالة الصفوف", category:"ألغاز", image:"https://source.unsplash.com/800x420/?match3,puzzle,game"},
      {id:42, name:"مزرعة الأحلام", desc:"ازرع واعتنِ بمحصولك", category:"محاكاة", image:"https://source.unsplash.com/800x420/?farm,farming,harvest"},
      {id:43, name:"شطرنج سريع", desc:"لعب شطرنج ضد خصم ذكي", category:"استراتيجية", image:"https://source.unsplash.com/800x420/?chess,board,game"},
      {id:44, name:"بطولة الملاكمة", desc:"قاتل لتصبح بطل الحلبة", category:"رياضة", image:"https://source.unsplash.com/800x420/?boxing,ring,match"},
      {id:45, name:"مطاردة اللصوص", desc:"أمسِك المطلوب قبل هروبه", category:"أكشن", image:"https://source.unsplash.com/800x420/?police,chase,thief"},
      {id:46, name:"لغز البرمجة", desc:"حل مهام منطقية برمجية", category:"تعليمي", image:"https://source.unsplash.com/800x420/?coding,puzzle,programming"},
      {id:47, name:"مهمة الفضاء", desc:"قم بمهام استكشاف لكوكب جديد", category:"مغامرة", image:"https://source.unsplash.com/800x420/?space,mission,planet"},
      {id:48, name:"قهر الممرات", desc:"تنقّل عبر ممرات خطرة", category:"أركيد", image:"https://source.unsplash.com/800x420/?corridor,endless,runner"},
      {id:49, name:"ممر الأحجار", desc:"حل ألغاز التحكم بالحركة", category:"ألغاز", image:"https://source.unsplash.com/800x420/?stone,puzzle,rocks"},
      {id:50, name:"تحدي السرعة", desc:"اختبر سرعتك وردود فعلك", category:"أركيد", image:"https://source.unsplash.com/800x420/?speed,fast,game"},
      {id:51, name:"محاكاة القطار", desc:"قد قطارك بأمان ووقت مثالي", category:"محاكاة", image:"https://source.unsplash.com/800x420/?train,railway,simulator"},
      {id:52, name:"تدريب المهارات", desc:"تمارين ذهنية لتطوير التركيز", category:"تعليمي", image:"https://source.unsplash.com/800x420/?training,brain,skills"},
      {id:53, name:"صراع الآلهة", desc:"معارك أسطورية بين آلهة", category:"مغامرة", image:"https://source.unsplash.com/800x420/?gods,mythic,battle"},
      {id:54, name:"نزال الساموراي", desc:"قاتл كساموراي قديم", category:"أكشن", image:"https://source.unsplash.com/800x420/?samurai,sword,duel"},
      {id:55, name:"مهمة الإنقاذ البحري", desc:"أنقذ السفن الغارقة", category:"مغامرة", image:"https://source.unsplash.com/800x420/?sea,rescue,ship"},
      {id:56, name:"مزرعة الديناصورات", desc:"اعتنِ بديناصوراتك الصغيرة", category:"محاكاة", image:"https://source.unsplash.com/800x420/?dinosaur,farm,park"},
      {id:57, name:"قواعد المدينة", desc:"حل مشكلات سكان مدينتك", category:"استراتيجية", image:"https://source.unsplash.com/800x420/?city,management,planning"},
      {id:58, name:"لعبة الكاريوكي", desc:"غنِ وتصدر قوائم المتصدرين", category:"موسيقى", image:"https://source.unsplash.com/800x420/?karaoke,singing,microphone"},
      {id:59, name:"ممر النجوم", desc:"اقفز عبر النجوم بمهارة", category:"أركيد", image:"https://source.unsplash.com/800x420/?stars,jump,space"},
      {id:60, name:"لعبة المبارزة", desc:"تحدى الخصوم في مبارزات سريعة", category:"رياضة", image:"https://source.unsplash.com/800x420/?fencing,duel,match"},
      {id:61, name:"لغز الظلال", desc:"استخدم الضوء لحل الألغاز", category:"ألغاز", image:"https://source.unsplash.com/800x420/?shadow,light,puzzle"},
      {id:62, name:"رحلة القراصنة", desc:"ابحر وابحث عن الكنوز", category:"مغامرة", image:"https://source.unsplash.com/800x420/?pirate,ship,treasure"},
      {id:63, name:"قائد الفريق", desc:"أصدر الأوامر لتحقيق النصر", category:"استراتيجية", image:"https://source.unsplash.com/800x420/?commander,army,strategy"},
      {id:64, name:"خليج الصياد", desc:"أدر خليجاً لصيد الأسماك", category:"محاكاة", image:"https://source.unsplash.com/800x420/?bay,fishing,harbor"},
      {id:65, name:"مغادرة المحطة", desc:"نقّل المركبة عبر المحطة بنظام", category:"ألغاز", image:"https://source.unsplash.com/800x420/?station,train,puzzle"},
      {id:66, name:"ممر الجليد", desc:"تزلج وتجنب العقبات الجليدية", category:"رياضة", image:"https://source.unsplash.com/800x420/?ice,skating,winter"},
      {id:67, name:"حكايات المدينة", desc:"سرد تفاعلي مع اختياراتك", category:"مغامرة", image:"https://source.unsplash.com/800x420/?story,city,interactive"},
      {id:68, name:"مختبر الكيمياء", desc:"امزج المواد لصنع مركبات", category:"تعليمي", image:"https://source.unsplash.com/800x420/?chemistry,lab,experiment"},
      {id:69, name:"سباق الطائرات الورقية", desc:"حافظ على طائرتك في الهواء", category:"سباق", image:"https://source.unsplash.com/800x420/?kite,flight,competition"},
      {id:70, name:"صانع الأبطال", desc:"اصنع بطلك وطوره للقتال", category:"أركيد", image:"https://source.unsplash.com/800x420/?hero,creation,game"}
    ];

    const grid = document.getElementById('grid');
    const filtersDiv = document.getElementById('filters');
    const searchInput = document.getElementById('searchInput');
    const clearBtn = document.getElementById('clearBtn');
    const sortSelect = document.getElementById('sortSelect');
    const activeCatSpan = document.getElementById('activeCat');
    const emptyDiv = document.getElementById('empty');

    const FAVORITES_KEY = 'kira_favorites_v1';
    const RATINGS_KEY = 'kira_ratings_v1';
    let favorites = JSON.parse(localStorage.getItem(FAVORITES_KEY) || '[]');
    let ratings = JSON.parse(localStorage.getItem(RATINGS_KEY) || '{}');

    const categories = ['الكل', ...Array.from(new Set(games.map(g=>g.category)))];

    let activeCategory = 'الكل';
    categories.forEach(cat=>{
      const btn = document.createElement('button');
      btn.className = 'filter-btn' + (cat==='الكل' ? ' active' : '');
      btn.textContent = cat;
      btn.addEventListener('click', ()=>{
        document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        activeCategory = cat;
        activeCatSpan.textContent = cat;
        renderGames();
      });
      filtersDiv.appendChild(btn);
    });

    clearBtn.addEventListener('click', ()=>{
      searchInput.value='';
      renderGames();
      searchInput.focus();
    });

    searchInput.addEventListener('input', debounce(renderGames, 220));
    sortSelect.addEventListener('change', renderGames);

    function downloadLink(game){
      const safe = game.name.toLowerCase().replace(/\s+/g,'_').replace(/[^\w\-]/g,'');
      return `downloads/${safe}.zip`;
    }

    function createCard(game){
      const el = document.createElement('article');
      el.className = 'card';
      el.dataset.name = game.name;

      // صورة اللعبة تظهر فوق الاسم كما طلبت
      el.innerHTML = `
        <img loading="lazy" class="thumb" src="${game.image}" alt="${escapeHTML(game.name)}">
        <div class="card-body">
          <div class="game-title">
            <h3>${escapeHTML(game.name)}</h3>
            <div style="display:flex;gap:8px;align-items:center">
              <button class="fav" title="إضافة للمفضلة"> ${favorites.includes(game.id)?'❤️':'🤍'} </button>
            </div>
          </div>

          <p class="meta">${escapeHTML(game.desc)}</p>

          <div class="tags">
            <span class="tag">${escapeHTML(game.category)}</span>
          </div>

          <div class="actions">
            <div class="left-actions">
              <a class="btn" href="${downloadLink(game)}" download>تحميل</a>
              <button class="btn outline" data-play>تشغيل</button>
            </div>

            <div style="display:flex;flex-direction:column;align-items:flex-start;gap:6px">
              <div class="stars" title="قيم اللعبة">
                ${renderStars(game.id)}
              </div>
              <div style="font-size:12px;color:var(--muted)">معرّف: #${game.id}</div>
            </div>
          </div>
        </div>
      `;

      const favBtn = el.querySelector('.fav');
      favBtn.addEventListener('click', ()=>{
        toggleFavorite(game.id, favBtn);
      });

      const playBtn = el.querySelector('[data-play]');
      playBtn.addEventListener('click', ()=>{
        alert(`تشغيل نسخة تجريبية من: ${game.name}\n(هذه مجرد معاينة — استبدل بنظام تشغيل فعلي لاحقًا)`);
      });

      el.querySelectorAll('.star').forEach(st=>{
        st.addEventListener('click', (e)=>{
          const value = Number(e.currentTarget.dataset.value);
          setRating(game.id, value);
          el.querySelector('.stars').innerHTML = renderStars(game.id);
          el.querySelectorAll('.star').forEach(ns=>{
            ns.addEventListener('click', (ev)=>{
              setRating(game.id, Number(ev.currentTarget.dataset.value));
              el.querySelector('.stars').innerHTML = renderStars(game.id);
            });
          });
        });
      });

      return el;
    }

    function renderStars(id){
      const current = ratings[id] || 0;
      let html = '';
      for(let i=1;i<=5;i++){
        html += `<span class="star ${i<=current ? 'on' : ''}" data-value="${i}">★</span>`;
      }
      return html;
    }

    function toggleFavorite(id, btnEl){
      if(favorites.includes(id)){
        favorites = favorites.filter(x=>x!==id);
      } else {
        favorites.push(id);
      }
      localStorage.setItem(FAVORITES_KEY, JSON.stringify(favorites));
      btnEl.classList.toggle('active');
      btnEl.innerHTML = favorites.includes(id) ? '❤️' : '🤍';
    }

    function setRating(id, value){
      ratings[id] = value;
      localStorage.setItem(RATINGS_KEY, JSON.stringify(ratings));
    }

    function filterGames(){
      const q = searchInput.value.trim().toLowerCase();
      let list = games.slice();

      if(activeCategory !== 'الكل'){
        list = list.filter(g => g.category === activeCategory);
      }
      if(q){
        list = list.filter(g=>{
          return g.name.toLowerCase().includes(q) || g.desc.toLowerCase().includes(q) || g.category.toLowerCase().includes(q);
        });
      }

      const sort = sortSelect.value;
      if(sort === 'popular'){
        list.sort((a,b)=>{
          const ra = ratings[a.id]||0, rb = ratings[b.id]||0;
          return rb - ra;
        });
      } else if(sort === 'alpha'){
        list.sort((a,b)=> a.name.localeCompare(b.name,'ar'));
      }

      return list;
    }

    function renderGames(){
      const list = filterGames();
      grid.innerHTML = '';
      if(list.length === 0){
        emptyDiv.style.display='block';
      } else {
        emptyDiv.style.display='none';
      }
      list.forEach(g=>{
        grid.appendChild(createCard(g));
      });
    }

    function escapeHTML(str){
      return String(str).replace(/[&<>"']/g, function(m){
        return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]);
      });
    }

    function debounce(fn, wait){
      let t;
      return function(...a){ clearTimeout(t); t = setTimeout(()=>fn.apply(this,a), wait); };
    }

    renderGames();

    document.addEventListener('keydown', (e)=>{
      if(e.key === 'k' && (e.ctrlKey || e.metaKey)){
        e.preventDefault();
        searchInput.focus();
      }
    });

    /* ملاحظة مهمة:
       - روابط الصور هنا تحصل صوراً مناسبة من Unsplash بناءً على الكلمات المفتاحية.
       - إذا أردت صورًا ثابتة ومضمونة، أقدر أحفظ لك مجموعة صور داخل مجلد images/ وأعدل روابط كل لعبة لتشير إليها (سأختار أو ترفع الصور).
    */

  </script>
</body>
</html>
